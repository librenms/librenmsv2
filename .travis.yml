dist: trusty
sudo: required # mysql socket bug in container based trusty image

language: php

php:
  - 5.6
  - 7.0
  - 7.1
  - hhvm

matrix:
  fast_finish: true
  allow_failures:
  - php: hhvm

services:
  - mysql

env:
  - PHPUNIT_DB_CONNECTION=testing_mysql

cache:
  directories:
    - vendor
    - $HOME/.cache/composer
    - node_modules

before_install:
  # Disable xdebug (hhvm doesn't support xdebug)
  - if [ "$TRAVIS_PHP_VERSION" != "hhvm" ]; then phpenv config-rm xdebug.ini; fi
  - mysql -e 'CREATE DATABASE phpunit_librenms;'
  - mysql -e 'GRANT ALL ON phpunit_librenms.* TO 'travis'@'localhost';'
  - nvm install 7

install:
  - travis_retry composer install --no-interaction --prefer-dist
  - travis_retry npm install

before_script:
  - cp .env.example .env
  - php artisan key:generate
  - npm run production

script:
  - vendor/bin/phpunit
  - vendor/bin/phpcs -n -p --colors --extensions=php --standard=PSR2 --ignore=/vendor,/storage,/database,/public,/bootstrap/cache,/_ide_helper.php ./
